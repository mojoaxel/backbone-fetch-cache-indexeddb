/**
 * @see https://github.com/mojoaxel/backbone-fetch-cache-indexeddb#backbone-fetch-cache-indexeddb
 * @copyright 2019 by Alexander Wunschik <mail@wunschik.it>
 * @version 5.0.2
 * @license MIT
 */
!function i(a,s,c){function u(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(h)return h(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[t]={exports:{}};a[t][0].call(o.exports,function(e){return u(a[t][1][e]||e)},o,o.exports,i,a,s,c)}return s[t].exports}for(var h="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,n,t){!function(e,t,r){"use strict";"function"==typeof define?define(t):void 0!==n&&n.exports?n.exports=t():r.IDBStore=t()}(0,function(){"use strict";function l(e){throw e}function f(){}function e(e,t){for(var r in void 0===t&&"function"==typeof e&&(t=e),"[object Object]"!=Object.prototype.toString.call(e)&&(e={}),i)this[r]=void 0!==e[r]?e[r]:i[r];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,t&&(this.onStoreReady=t);var n="object"==typeof window?window:self,o=this.implementationPreference.filter(function(e){return e in n});if(this.implementation=o[0],this.idb=n[this.implementation],!this.idb)return this.onError(new Error("Could not find any indexedDB implementation. Please update your browser or change your Privacy settings."));this.keyRange=n.IDBKeyRange||n.webkitIDBKeyRange||n.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()}var i={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:l,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},t={constructor:e,version:"1.7.2",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var e=this.idb.open(this.dbName,this.dbVersion),o=!1;e.onerror=function(e){if(function(e){{if("error"in e.target)return"VersionError"==e.target.error.name;if("errorCode"in e.target)return 12==e.target.errorCode}return!1}(e))this.onError(new Error("The version number provided is lower than the existing one."));else{var t;if(e.target.error)t=e.target.error;else{var r="IndexedDB unknown error occurred when opening DB "+this.dbName+" version "+this.dbVersion;"errorCode"in e.target&&(r+=" with error code "+e.target.errorCode),t=new Error(r)}this.onError(t)}}.bind(this),e.onsuccess=function(e){if(!o)if(this.db)this.onStoreReady();else if(this.db=e.target.result,"string"!=typeof this.db.version)if(this.db.objectStoreNames.contains(this.storeName)){var t=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=t.objectStore(this.storeName);var n=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var t=e.name;if(!t)return o=!0,void this.onError(new Error("Cannot create index: No index name given."));if(this.normalizeIndexData(e),this.hasIndex(t)){var r=this.store.index(t);this.indexComplies(r,e)||(o=!0,this.onError(new Error('Cannot modify index "'+t+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),n.splice(n.indexOf(t),1)}else o=!0,this.onError(new Error('Cannot create new index "'+t+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),n.length&&(o=!0,this.onError(new Error('Cannot delete index(es) "'+n.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),o||this.onStoreReady()}else this.onError(new Error("Object store couldn't be created."));else this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."))}.bind(this),e.onupgradeneeded=function(e){if(this.db=e.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=e.target.transaction.objectStore(this.storeName);else{var t={autoIncrement:this.autoIncrement};null!==this.keyPath&&(t.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,t)}var n=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var t=e.name;if(t||(o=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(e),this.hasIndex(t)){var r=this.store.index(t);this.indexComplies(r,e)||(this.store.deleteIndex(t),this.store.createIndex(t,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})),n.splice(n.indexOf(t),1)}else this.store.createIndex(t,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})},this),n.length&&n.forEach(function(e){this.store.deleteIndex(e)},this)}.bind(this)},deleteDatabase:function(e,t){if(this.idb.deleteDatabase){this.db.close();var r=this.idb.deleteDatabase(this.dbName);r.onsuccess=e,r.onerror=t}else t(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(e,t,r,n){null!==this.keyPath&&(n=r,r=t,t=e),n||(n=l),r||(r=f);var o,i=!1,a=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);return s.oncomplete=function(){(i?r:n)(a)},s.onabort=n,s.onerror=n,(o=null!==this.keyPath?(this._addIdPropertyIfNeeded(t),s.objectStore(this.storeName).put(t)):s.objectStore(this.storeName).put(t,e)).onsuccess=function(e){i=!0,a=e.target.result},o.onerror=n,s},get:function(e,t,r){r||(r=l),t||(t=f);var n=!1,o=null,i=this.db.transaction([this.storeName],this.consts.READ_ONLY);i.oncomplete=function(){(n?t:r)(o)},i.onabort=r,i.onerror=r;var a=i.objectStore(this.storeName).get(e);return a.onsuccess=function(e){n=!0,o=e.target.result},a.onerror=r,i},remove:function(e,t,r){r||(r=l),t||(t=f);var n=!1,o=null,i=this.db.transaction([this.storeName],this.consts.READ_WRITE);i.oncomplete=function(){(n?t:r)(o)},i.onabort=r,i.onerror=r;var a=i.objectStore(this.storeName).delete(e);return a.onsuccess=function(e){n=!0,o=e.target.result},a.onerror=r,i},batch:function(e,t,s){if(s||(s=l),t||(t=f),"[object Array]"!=Object.prototype.toString.call(e))s(new Error("dataArray argument must be of type Array."));else if(0===e.length)return t(!0);var r=e.length,c=!1,n=!1,u=this.db.transaction([this.storeName],this.consts.READ_WRITE);u.oncomplete=function(){(n?t:s)(n)},u.onabort=s,u.onerror=s;function h(){0!==--r||c||(n=c=!0)}return e.forEach(function(e){function t(e){u.abort(),c||(c=!0,s(e,r,n))}var r=e.type,n=e.key,o=e.value;if("remove"==r){var i=u.objectStore(this.storeName).delete(n);i.onsuccess=h,i.onerror=t}else if("put"==r){var a;(a=null!==this.keyPath?(this._addIdPropertyIfNeeded(o),u.objectStore(this.storeName).put(o)):u.objectStore(this.storeName).put(o,n)).onsuccess=h,a.onerror=t}},this),u},putBatch:function(e,t,r){var n=e.map(function(e){return{type:"put",value:e}});return this.batch(n,t,r)},upsertBatch:function(t,e,r,n){"function"==typeof e&&(n=r=e,e={}),n||(n=l),r||(r=f),e||(e={}),"[object Array]"!=Object.prototype.toString.call(t)&&n(new Error("dataArray argument must be of type Array."));var o=e.keyField||this.keyPath,i=t.length,a=!1,s=!1,c=0,u=this.db.transaction([this.storeName],this.consts.READ_WRITE);u.oncomplete=function(){s?r(t):n(!1)},u.onabort=n,u.onerror=n;function h(e){t[c++][o]=e.target.result,0!==--i||a||(s=a=!0)}return t.forEach(function(e){var t,r=e.key;(t=null!==this.keyPath?(this._addIdPropertyIfNeeded(e),u.objectStore(this.storeName).put(e)):u.objectStore(this.storeName).put(e,r)).onsuccess=h,t.onerror=function(e){u.abort(),a||(a=!0,n(e))}},this),u},removeBatch:function(e,t,r){var n=e.map(function(e){return{type:"remove",key:e}});return this.batch(n,t,r)},getBatch:function(e,t,r,n){if(r||(r=l),t||(t=f),n||(n="sparse"),"[object Array]"!=Object.prototype.toString.call(e))r(new Error("keyArray argument must be of type Array."));else if(0===e.length)return t([]);var o=[],i=e.length,a=!1,s=null,c=this.db.transaction([this.storeName],this.consts.READ_ONLY);c.oncomplete=function(){(a?t:r)(s)},c.onabort=r,c.onerror=r;function u(e){e.target.result||"dense"==n?o.push(e.target.result):"sparse"==n&&o.length++,0===--i&&(a=!0,s=o)}return e.forEach(function(e){var t=c.objectStore(this.storeName).get(e);t.onsuccess=u,t.onerror=function(e){!0,r(s=e),c.abort()}},this),c},getAll:function(e,t){t||(t=l),e||(e=f);var r=this.db.transaction([this.storeName],this.consts.READ_ONLY),n=r.objectStore(this.storeName);return n.getAll?this._getAllNative(r,n,e,t):this._getAllCursor(r,n,e,t),r},_getAllNative:function(e,t,r,n){var o=!1,i=null;e.oncomplete=function(){(o?r:n)(i)},e.onabort=n,e.onerror=n;var a=t.getAll();a.onsuccess=function(e){o=!0,i=e.target.result},a.onerror=n},_getAllCursor:function(e,t,r,n){var o=[],i=!1,a=null;e.oncomplete=function(){(i?r:n)(a)},e.onabort=n,e.onerror=n;var s=t.openCursor();s.onsuccess=function(e){var t=e.target.result;t?(o.push(t.value),t.continue()):(i=!0,a=o)},s.onError=n},clear:function(e,t){t||(t=l),e||(e=f);var r=!1,n=null,o=this.db.transaction([this.storeName],this.consts.READ_WRITE);o.oncomplete=function(){(r?e:t)(n)},o.onabort=t,o.onerror=t;var i=o.objectStore(this.storeName).clear();return i.onsuccess=function(e){r=!0,n=e.target.result},i.onerror=t,o},_addIdPropertyIfNeeded:function(e){void 0===e[this.keyPath]&&(e[this.keyPath]=this._insertIdCount+++Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(i,a){return["keyPath","unique","multiEntry"].every(function(e){if("multiEntry"==e&&void 0===i[e]&&!1===a[e])return!0;if("keyPath"!=e||"[object Array]"!=Object.prototype.toString.call(a[e]))return a[e]==i[e];var t=a.keyPath,r=i.keyPath;if("string"==typeof r)return t.toString()==r;if("function"!=typeof r.contains&&"function"!=typeof r.indexOf)return!1;if(r.length!==t.length)return!1;for(var n=0,o=t.length;n<o;n++)if(!(r.contains&&r.contains(t[n])||r.indexOf(-1!==t[n])))return!1;return!0})},iterate:function(n,o){var e="desc"==(o=c({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:l,limit:1/0,offset:0,allowItemRejection:!1},o||{})).order.toLowerCase()?"PREV":"NEXT";o.filterDuplicates&&(e+="_NO_DUPLICATE");var i=!1,a=this.db.transaction([this.storeName],this.consts[o.writeAccess?"READ_WRITE":"READ_ONLY"]),t=a.objectStore(this.storeName);o.index&&(t=t.index(o.index));var s=0;a.oncomplete=function(){i?o.onEnd?o.onEnd():n(null):o.onError(null)},a.onabort=o.onError,a.onerror=o.onError;var r=t.openCursor(o.keyRange,this.consts[e]);return r.onerror=o.onError,r.onsuccess=function(e){var t=e.target.result;if(t)if(o.offset)t.advance(o.offset),o.offset=0;else{var r=n(t.value,t,a);o.allowItemRejection&&!1===r||s++,o.autoContinue&&(s+o.offset<o.limit?t.continue():i=!0)}else i=!0},a},query:function(e,r){var n=[],o=0;return(r=r||{}).autoContinue=!0,r.writeAccess=!1,r.allowItemRejection=!!r.filter,r.onEnd=function(){e(n,o)},this.iterate(function(e){o++;var t=!r.filter||r.filter(e);return!1!==t&&n.push(e),t},r)},count:function(e,t){var r=(t=c({index:null,keyRange:null},t||{})).onError||l,n=!1,o=null,i=this.db.transaction([this.storeName],this.consts.READ_ONLY);i.oncomplete=function(){(n?e:r)(o)},i.onabort=r,i.onerror=r;var a=i.objectStore(this.storeName);t.index&&(a=a.index(t.index));var s=a.count(t.keyRange);return s.onsuccess=function(e){n=!0,o=e.target.result},s.onError=r,i},makeKeyRange:function(e){var t,r=void 0!==e.lower,n=void 0!==e.upper;switch(!0){case void 0!==e.only:t=this.keyRange.only(e.only);break;case r&&n:t=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case r:t=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case n:t=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return t}},o={};function c(e,t){var r,n;for(r in t)(n=t[r])!==o[r]&&n!==e[r]&&(e[r]=n);return e}return e.prototype=t,e.version=t.version,e},this)},{}],2:[function(e,t,r){function b(e,t){"WARN"===e&&window.console.warn("Backbone.fetchCache: ",t,t||"")}var n=e("./SimpleStore"),m={model:{fetch:Backbone.Model.prototype.fetch,sync:Backbone.Model.prototype.sync},collection:{fetch:Backbone.Collection.prototype.fetch,sync:Backbone.Collection.prototype.sync}};function o(i){var a="model",s=this instanceof Backbone.Model?a:"collection",n=this;if(i=_.extend({parse:!0},i),_.isBoolean(i.cache)&&!1===i.cache||!1===Backbone.fetchCache.enabled&&_.isUndefined(i.cache)||!Backbone.fetchCache.checkIfInit())return m[s].fetch.call(n,i);var c=i.context||this,r=new $.Deferred,o=r.promise();o.abort=_.bind(r.reject,c);var u=!1,h=function(e,t){t=t||{};var r=_.result(e,"url");if(_.isUndefined(r)||!r.length)throw window.console.warn(JSON.stringify(e)),new Error('The model/collection is missing the "url" property or function');return r+(t.data?"?"+$.param(t.data):"")}(n,i),l=function(e,t){var n=(t=t||{}).error,o=t.context||e;return t.error=function(e,t,r){n&&n.call(o,e,t,r),Backbone.fetchCache.trigger("error",t),e.trigger("error",e,t,r)},n}(this,i)||Backbone.fetchCache.onError,f=i.success;function d(){u=!1;var e=_.clone(i);e.parse=!1;var t=m[s].fetch.call(n,e);o.abort=t.abort,o=_.extend(o,_.pick(t,function(e,t,r){return!_.isFunction(e)})),t.then(_.bind(r.resolve,c),_.bind(r.reject,c),function(e,t,r){o=_.extend(o,_.pick(r,function(e,t,r){return!_.isFunction(e)}))})}return i.success=function(n,o,e){function t(e){var t=i.parse&&s===a?n.parse(e,i):e;if(s===a){if(!n.set(t,i))return!1}else{var r=i.reset?"reset":"set";n[r](t,i)}f&&f.call(c,n,t,i),n.trigger("sync",n,o,i)}if(u)t(o);else{var r={timestamp:(new Date).getTime(),data:o};Backbone.fetchCache.store.setItem(h,r,function(){Backbone.fetchCache.trigger("setitem",h,r),t(r.data)},function(e){l(e),t(r.data)})}},n.trigger("cacherequest",n,i),Backbone.fetchCache.store.getItem(h,function(e){if(e){if(!e.timestamp)throw new Error("Cache data has no timestamp");var t=_.result(i,"maxAge");t=_.isNumber(t)?t:Backbone.fetchCache.maxAge,t*=1e3;var r=Math.round((new Date).getTime()-e.timestamp);if(Backbone.fetchCache.trigger("getitem",h,e,t),r<t)return u=!0,void i.success.call(n,n,e.data);Backbone.fetchCache.trigger("aged",h,e,t),d()}else Backbone.fetchCache.trigger("notfound",h),d()},function(e){b("WARN","CACHE error while reading from indexeddb. Falling back to ajax request"),d()}),o}Backbone.fetchCache={isInit:!1,enabled:!1,maxAge:1/0,onError:function(e){Backbone.fetchCache.trigger("error",e)}},_.extend(Backbone.fetchCache,Backbone.Events),Backbone.fetchCache.init=function(e,t){b("Backbone.fetchCache.init: ",e);var r=Backbone.fetchCache;return r=function(e,t){if(t=t||{},_.isUndefined(t.name)||_.isNull(t.name))throw new Error('Setting missing. The FetchCache needs a "name"');if(!_.isString(t.name)||t.name.trim().length<=0)throw new Error('The "name" parameter must be a valid String');return e.name=t.name,_.isBoolean(t.enabled)&&(e.enabled=t.enabled),_.isFinite(t.maxAge)&&(e.maxAge=t.maxAge),e}(r,e),Backbone.fetchCache.store=new n({name:r.name},function(){r.isInit=!0,t&&t(r)},r.onError),r},Backbone.fetchCache.checkIfInit=function(){var e=Backbone.fetchCache;return b("Backbone.fetchCache.checkIfInit: ",e.isInit),e.isInit||window.console.warn('FetchCache is not initialized and therefore not active. Please initialize the store first by calling "Backbone.fetchcache.init"'),e.isInit},Backbone.fetchCache.clear=function(e){b("Backbone.fetchCache.clear");var t=Backbone.fetchCache;return t.checkIfInit()&&t.store.clear(function(){b("CLEAR successfull"),t.trigger("clear",t),e&&e(t)}),t},Backbone.fetchCache.purge=function(e){b("Backbone.fetchCache.purge");var t=Backbone.fetchCache;return t.isInit?t.store.purge(function(){t.isInit=!1,delete t.store,b("PURGE successfull"),t.trigger("clear",t),t.stopListening(),e&&e(t)}):e&&e(t),t},Backbone.Model.prototype.fetch=o,Backbone.Collection.prototype.fetch=o,t.exports=Backbone},{"./SimpleStore":3}],3:[function(e,t,r){var o=e("idb-wrapper");function i(e){throw new Error(e)}function a(e){return e}function n(e,t,r){var n=this;return n.settings=e||{},n.settings.name=e.name||"store",n.idb=new o({storeName:n.settings.name,keyPath:null,autoIncrement:!1,onError:r||i,onStoreReady:function(){t(n.idb)}}),this}n.prototype.setItem=function(e,t,r,n){try{this.idb.put(a(e),function(e){return e?JSON.stringify(e):null}(t),r,n||i)}catch(e){(n||i)(e)}return this},n.prototype.getItem=function(e,t,r){try{this.idb.get(a(e),function(e){t(function(e){return e?JSON.parse(e):null}(e))},r||i)}catch(e){(r||i)(e)}return this},n.prototype.removeItem=function(e,t,r){try{this.idb.remove(a(e),function(){t()},r||i)}catch(e){(r||i)(e)}return this},n.prototype.clear=function(e,t){try{this.idb.clear(e,t||i)}catch(e){(t||i)(e)}return this},n.prototype.purge=function(e,t){var r=this;try{r.idb.clear(function(){r.idb.deleteDatabase(),delete r.idb,e&&e()},t||i)}catch(e){(t||i)(e)}return r},t.exports=n},{"idb-wrapper":1}]},{},[2,3]);