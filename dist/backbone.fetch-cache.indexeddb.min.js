/**
 * @see https://github.com/mojoaxel/backbone-fetch-cache-indexeddb#backbone-fetch-cache-indexeddb
 * @copyright 2018 by Alexander Wunschik <mail@wunschik.it>
 * @version 4.5.7
 * @license MIT
 */

!function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[a]={exports:{}};t[a][0].call(h.exports,function(e){var r=t[a][1][e];return o(r||e)},h,h.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){!function(e,r,n){"use strict";"function"==typeof define?define(r):void 0!==t&&t.exports?t.exports=r():n.IDBStore=r()}(0,function(){"use strict";var e=function(e){throw e},t=function(){},r={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:e,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},n=function(e,t){for(var n in void 0===t&&"function"==typeof e&&(t=e),"[object Object]"!=Object.prototype.toString.call(e)&&(e={}),r)this[n]=void 0!==e[n]?e[n]:r[n];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,t&&(this.onStoreReady=t);var o="object"==typeof window?window:self,i=this.implementationPreference.filter(function(e){return e in o});if(this.implementation=i[0],this.idb=o[this.implementation],!this.idb)return this.onError(new Error("Could not find any indexedDB implementation. Please update your browser or change your Privacy settings."));this.keyRange=o.IDBKeyRange||o.webkitIDBKeyRange||o.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()},o={constructor:n,version:"1.7.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var e=this.idb.open(this.dbName,this.dbVersion),t=!1;e.onerror=function(e){if(function(e){{if("error"in e.target)return"VersionError"==e.target.error.name;if("errorCode"in e.target)return 12==e.target.errorCode}return!1}(e))this.onError(new Error("The version number provided is lower than the existing one."));else{var t;if(e.target.error)t=e.target.error;else{var r="IndexedDB unknown error occurred when opening DB "+this.dbName+" version "+this.dbVersion;"errorCode"in e.target&&(r+=" with error code "+e.target.errorCode),t=new Error(r)}this.onError(t)}}.bind(this),e.onsuccess=function(e){if(!t)if(this.db)this.onStoreReady();else if(this.db=e.target.result,"string"!=typeof this.db.version)if(this.db.objectStoreNames.contains(this.storeName)){var r=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=r.objectStore(this.storeName);var n=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var r=e.name;if(!r)return t=!0,void this.onError(new Error("Cannot create index: No index name given."));if(this.normalizeIndexData(e),this.hasIndex(r)){var o=this.store.index(r);this.indexComplies(o,e)||(t=!0,this.onError(new Error('Cannot modify index "'+r+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),n.splice(n.indexOf(r),1)}else t=!0,this.onError(new Error('Cannot create new index "'+r+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),n.length&&(t=!0,this.onError(new Error('Cannot delete index(es) "'+n.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),t||this.onStoreReady()}else this.onError(new Error("Object store couldn't be created."));else this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."))}.bind(this),e.onupgradeneeded=function(e){if(this.db=e.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=e.target.transaction.objectStore(this.storeName);else{var r={autoIncrement:this.autoIncrement};null!==this.keyPath&&(r.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,r)}var n=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var r=e.name;if(r||(t=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(e),this.hasIndex(r)){var o=this.store.index(r);this.indexComplies(o,e)||(this.store.deleteIndex(r),this.store.createIndex(r,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})),n.splice(n.indexOf(r),1)}else this.store.createIndex(r,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})},this),n.length&&n.forEach(function(e){this.store.deleteIndex(e)},this)}.bind(this)},deleteDatabase:function(e,t){if(this.idb.deleteDatabase){this.db.close();var r=this.idb.deleteDatabase(this.dbName);r.onsuccess=e,r.onerror=t}else t(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(r,n,o,i){null!==this.keyPath&&(i=o,o=n,n=r),i||(i=e),o||(o=t);var a,s=!1,c=null,u=this.db.transaction([this.storeName],this.consts.READ_WRITE);return u.oncomplete=function(){(s?o:i)(c)},u.onabort=i,u.onerror=i,null!==this.keyPath?(this._addIdPropertyIfNeeded(n),a=u.objectStore(this.storeName).put(n)):a=u.objectStore(this.storeName).put(n,r),a.onsuccess=function(e){s=!0,c=e.target.result},a.onerror=i,u},get:function(r,n,o){o||(o=e),n||(n=t);var i=!1,a=null,s=this.db.transaction([this.storeName],this.consts.READ_ONLY);s.oncomplete=function(){(i?n:o)(a)},s.onabort=o,s.onerror=o;var c=s.objectStore(this.storeName).get(r);return c.onsuccess=function(e){i=!0,a=e.target.result},c.onerror=o,s},remove:function(r,n,o){o||(o=e),n||(n=t);var i=!1,a=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);s.oncomplete=function(){(i?n:o)(a)},s.onabort=o,s.onerror=o;var c=s.objectStore(this.storeName).delete(r);return c.onsuccess=function(e){i=!0,a=e.target.result},c.onerror=o,s},batch:function(r,n,o){if(o||(o=e),n||(n=t),"[object Array]"!=Object.prototype.toString.call(r))o(new Error("dataArray argument must be of type Array."));else if(0===r.length)return n(!0);var i=r.length,a=!1,s=!1,c=this.db.transaction([this.storeName],this.consts.READ_WRITE);c.oncomplete=function(){(s?n:o)(s)},c.onabort=o,c.onerror=o;var u=function(){0!==--i||a||(a=!0,s=!0)};return r.forEach(function(e){var t=e.type,r=e.key,n=e.value,i=function(e){c.abort(),a||(a=!0,o(e,t,r))};if("remove"==t){var s=c.objectStore(this.storeName).delete(r);s.onsuccess=u,s.onerror=i}else if("put"==t){var h;null!==this.keyPath?(this._addIdPropertyIfNeeded(n),h=c.objectStore(this.storeName).put(n)):h=c.objectStore(this.storeName).put(n,r),h.onsuccess=u,h.onerror=i}},this),c},putBatch:function(e,t,r){var n=e.map(function(e){return{type:"put",value:e}});return this.batch(n,t,r)},upsertBatch:function(r,n,o,i){"function"==typeof n&&(i=o=n,n={}),i||(i=e),o||(o=t),n||(n={}),"[object Array]"!=Object.prototype.toString.call(r)&&i(new Error("dataArray argument must be of type Array."));var a=n.keyField||this.keyPath,s=r.length,c=!1,u=!1,h=0,l=this.db.transaction([this.storeName],this.consts.READ_WRITE);l.oncomplete=function(){u?o(r):i(!1)},l.onabort=i,l.onerror=i;var f=function(e){r[h++][a]=e.target.result,0!==--s||c||(c=!0,u=!0)};return r.forEach(function(e){var t,r=e.key;null!==this.keyPath?(this._addIdPropertyIfNeeded(e),t=l.objectStore(this.storeName).put(e)):t=l.objectStore(this.storeName).put(e,r),t.onsuccess=f,t.onerror=function(e){l.abort(),c||(c=!0,i(e))}},this),l},removeBatch:function(e,t,r){var n=e.map(function(e){return{type:"remove",key:e}});return this.batch(n,t,r)},getBatch:function(r,n,o,i){if(o||(o=e),n||(n=t),i||(i="sparse"),"[object Array]"!=Object.prototype.toString.call(r))o(new Error("keyArray argument must be of type Array."));else if(0===r.length)return n([]);var a=[],s=r.length,c=!1,u=null,h=this.db.transaction([this.storeName],this.consts.READ_ONLY);h.oncomplete=function(){(c?n:o)(u)},h.onabort=o,h.onerror=o;var l=function(e){e.target.result||"dense"==i?a.push(e.target.result):"sparse"==i&&a.length++,0===--s&&(!0,c=!0,u=a)};return r.forEach(function(e){var t=h.objectStore(this.storeName).get(e);t.onsuccess=l,t.onerror=function(e){!0,u=e,o(e),h.abort()}},this),h},getAll:function(r,n){n||(n=e),r||(r=t);var o=this.db.transaction([this.storeName],this.consts.READ_ONLY),i=o.objectStore(this.storeName);return i.getAll?this._getAllNative(o,i,r,n):this._getAllCursor(o,i,r,n),o},_getAllNative:function(e,t,r,n){var o=!1,i=null;e.oncomplete=function(){(o?r:n)(i)},e.onabort=n,e.onerror=n;var a=t.getAll();a.onsuccess=function(e){o=!0,i=e.target.result},a.onerror=n},_getAllCursor:function(e,t,r,n){var o=[],i=!1,a=null;e.oncomplete=function(){(i?r:n)(a)},e.onabort=n,e.onerror=n;var s=t.openCursor();s.onsuccess=function(e){var t=e.target.result;t?(o.push(t.value),t.continue()):(i=!0,a=o)},s.onError=n},clear:function(r,n){n||(n=e),r||(r=t);var o=!1,i=null,a=this.db.transaction([this.storeName],this.consts.READ_WRITE);a.oncomplete=function(){(o?r:n)(i)},a.onabort=n,a.onerror=n;var s=a.objectStore(this.storeName).clear();return s.onsuccess=function(e){o=!0,i=e.target.result},s.onerror=n,a},_addIdPropertyIfNeeded:function(e){void 0===e[this.keyPath]&&(e[this.keyPath]=this._insertIdCount+++Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(e,t){return["keyPath","unique","multiEntry"].every(function(r){if("multiEntry"==r&&void 0===e[r]&&!1===t[r])return!0;if("keyPath"==r&&"[object Array]"==Object.prototype.toString.call(t[r])){var n=t.keyPath,o=e.keyPath;if("string"==typeof o)return n.toString()==o;if("function"!=typeof o.contains&&"function"!=typeof o.indexOf)return!1;if(o.length!==n.length)return!1;for(var i=0,a=n.length;i<a;i++)if(!(o.contains&&o.contains(n[i])||o.indexOf(-1!==n[i])))return!1;return!0}return t[r]==e[r]})},iterate:function(t,r){var n="desc"==(r=a({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:e,limit:1/0,offset:0,allowItemRejection:!1},r||{})).order.toLowerCase()?"PREV":"NEXT";r.filterDuplicates&&(n+="_NO_DUPLICATE");var o=!1,i=this.db.transaction([this.storeName],this.consts[r.writeAccess?"READ_WRITE":"READ_ONLY"]),s=i.objectStore(this.storeName);r.index&&(s=s.index(r.index));var c=0;i.oncomplete=function(){o?r.onEnd?r.onEnd():t(null):r.onError(null)},i.onabort=r.onError,i.onerror=r.onError;var u=s.openCursor(r.keyRange,this.consts[n]);return u.onerror=r.onError,u.onsuccess=function(e){var n=e.target.result;if(n)if(r.offset)n.advance(r.offset),r.offset=0;else{var a=t(n.value,n,i);r.allowItemRejection&&!1===a||c++,r.autoContinue&&(c+r.offset<r.limit?n.continue():o=!0)}else o=!0},i},query:function(e,t){var r=[],n=0;return(t=t||{}).autoContinue=!0,t.writeAccess=!1,t.allowItemRejection=!!t.filter,t.onEnd=function(){e(r,n)},this.iterate(function(e){n++;var o=!t.filter||t.filter(e);return!1!==o&&r.push(e),o},t)},count:function(t,r){var n=(r=a({index:null,keyRange:null},r||{})).onError||e,o=!1,i=null,s=this.db.transaction([this.storeName],this.consts.READ_ONLY);s.oncomplete=function(){(o?t:n)(i)},s.onabort=n,s.onerror=n;var c=s.objectStore(this.storeName);r.index&&(c=c.index(r.index));var u=c.count(r.keyRange);return u.onsuccess=function(e){o=!0,i=e.target.result},u.onError=n,s},makeKeyRange:function(e){var t,r=void 0!==e.lower,n=void 0!==e.upper;switch(!0){case void 0!==e.only:t=this.keyRange.only(e.only);break;case r&&n:t=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case r:t=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case n:t=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return t}},i={};function a(e,t){var r,n;for(r in t)(n=t[r])!==i[r]&&n!==e[r]&&(e[r]=n);return e}return n.prototype=o,n.version=o.version,n},this)},{}],2:[function(e,t,r){var n=e("./SimpleStore"),o={model:{fetch:Backbone.Model.prototype.fetch,sync:Backbone.Model.prototype.sync},collection:{fetch:Backbone.Collection.prototype.fetch,sync:Backbone.Collection.prototype.sync}},i=function(e,t){"WARN"===e&&window.console.warn("Backbone.fetchCache: ",t,arguments[1]||"")},a=function(e,t){var r=(t=t||{}).error,n=t.context||e;return t.error=function(e,t,o){r&&r.call(n,e,t,o),Backbone.fetchCache.trigger("error",t),e.trigger("error",e,t,o)},r};function s(e){var t="model",r=this instanceof Backbone.Model?t:"collection",n=this;if(e=_.extend({parse:!0},e),_.isBoolean(e.cache)&&!1===e.cache||!1===Backbone.fetchCache.enabled&&_.isUndefined(e.cache)||!Backbone.fetchCache.checkIfInit())return o[r].fetch.call(n,e);var s=e.context||this,c=new $.Deferred,u=c.promise();u.abort=_.bind(c.reject,s);var h=!1,l=function(e,t){t=t||{};var r=_.result(e,"url");if(_.isUndefined(r)||!r.length)throw window.console.warn(JSON.stringify(e)),new Error('The model/collection is missing the "url" property or function');return r+(t.data?"?"+$.param(t.data):"")}(n,e),f=a(this,e)||Backbone.fetchCache.onError,d=e.success;function b(){h=!1;var t=o[r].fetch.call(n,e);u.abort=t.abort,u=_.extend(u,_.pick(t,function(e,t,r){return!_.isFunction(e)})),t.then(_.bind(c.resolve,s),_.bind(c.reject,s),function(e,t,r){u=_.extend(u,_.pick(r,function(e,t,r){return!_.isFunction(e)}))})}return e.success=function(n,o,i){function a(i){var a=e.parse?n.parse(i,e):i;if(e.parse=!1,r===t){if(!n.set(a,e))return!1}else{var c=e.reset?"reset":"set";n[c](a,e)}d&&d.call(s,n,a,e),n.trigger("sync",n,o,e)}if(h)a(o);else{var c={timestamp:(new Date).getTime(),data:o};Backbone.fetchCache.store.setItem(l,c,function(){Backbone.fetchCache.trigger("setitem",l,c),a(c.data)},function(e){f(e),a(c.data)})}},n.trigger("cacherequest",n,e),Backbone.fetchCache.store.getItem(l,function(t){if(t){if(!t.timestamp)throw new Error("Cache data has no timestamp");var r=_.result(e,"maxAge");r=_.isNumber(r)?r:Backbone.fetchCache.maxAge,r*=1e3;var o=Math.round((new Date).getTime()-t.timestamp);if(Backbone.fetchCache.trigger("getitem",l,t,r),o<r)return h=!0,void e.success.call(n,n,t.data);Backbone.fetchCache.trigger("aged",l,t,r),b()}else Backbone.fetchCache.trigger("notfound",l),b()},function(e){i("WARN","CACHE error while reading from indexeddb. Falling back to ajax request"),b()}),u}Backbone.fetchCache={isInit:!1,enabled:!1,maxAge:1/0,onError:function(e){Backbone.fetchCache.trigger("error",e)}},_.extend(Backbone.fetchCache,Backbone.Events),Backbone.fetchCache.init=function(e,t){i("Backbone.fetchCache.init: ",e);var r=Backbone.fetchCache;return r=function(e,t){if(t=t||{},_.isUndefined(t.name)||_.isNull(t.name))throw new Error('Setting missing. The FetchCache needs a "name"');if(!_.isString(t.name)||t.name.trim().length<=0)throw new Error('The "name" parameter must be a valid String');return e.name=t.name,_.isBoolean(t.enabled)&&(e.enabled=t.enabled),_.isFinite(t.maxAge)&&(e.maxAge=t.maxAge),e}(r,e),Backbone.fetchCache.store=new n({name:r.name},function(){r.isInit=!0,t&&t(r)},r.onError),r},Backbone.fetchCache.checkIfInit=function(){var e=Backbone.fetchCache;return i("Backbone.fetchCache.checkIfInit: ",e.isInit),e.isInit||window.console.warn('FetchCache is not initialized and therefore not active. Please initialize the store first by calling "Backbone.fetchcache.init"'),e.isInit},Backbone.fetchCache.clear=function(e){i("Backbone.fetchCache.clear");var t=Backbone.fetchCache;return t.checkIfInit()?(t.store.clear(function(){i("CLEAR successfull"),t.trigger("clear",t),e&&e(t)}),t):t},Backbone.fetchCache.purge=function(e){i("Backbone.fetchCache.purge");var t=Backbone.fetchCache;return t.isInit?(t.store.purge(function(){t.isInit=!1,delete t.store,i("PURGE successfull"),t.trigger("clear",t),t.stopListening(),e&&e(t)}),t):(e&&e(t),t)},Backbone.Model.prototype.fetch=s,Backbone.Collection.prototype.fetch=s,t.exports=Backbone},{"./SimpleStore":3}],3:[function(e,t,r){var n=e("idb-wrapper");function o(e){throw new Error(e)}var i=function(e,t,r){var i=this;return i.settings=e||{},i.settings.name=e.name||"store",i.idb=new n({storeName:i.settings.name,keyPath:null,autoIncrement:!1,onError:r||o,onStoreReady:function(){t(i.idb)}}),this};i.prototype._formatKey=function(e){return e},i.prototype._serializeData=function(e){return e?JSON.stringify(e):null},i.prototype._deSerializeData=function(e){return e?JSON.parse(e):null},i.prototype.setItem=function(e,t,r,n){return this.idb.put(this._formatKey(e),this._serializeData(t),r,n||o),this},i.prototype.getItem=function(e,t,r){var n=this;try{n.idb.get(n._formatKey(e),function(e){t(n._deSerializeData(e))},r||o)}catch(e){(r||o)(e)}return n},i.prototype.clear=function(e,t){return this.idb.clear(e,t||o),this},i.prototype.purge=function(e,t){var r=this;return r.idb.clear(function(){r.idb.deleteDatabase(),delete r.idb,e&&e()},t||o),r},t.exports=i},{"idb-wrapper":1}]},{},[2,3]);